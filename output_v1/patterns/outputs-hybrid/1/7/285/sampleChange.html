<link rel="stylesheet" href="../../../../default.css">
<script src="../../../../highlight.pack.js"></script> 
<script>hljs.initHighlightingOnLoad();</script>
<html><h3>5803c43d7e79b969b12fb61ed423dbb07fddfc6c,guava-tests/test/com/google/common/collect/MapMakerInternalMapTest.java,MapMakerInternalMapTest,testSegmentGetAndContains,#,274
</h3><h3>Before Change</h3><pre><code class='java'>
  }

  public void testSegmentGetAndContains() {
    MapMakerInternalMap&lt;Object, Object&gt; map = makeMap(createMapMaker().<a id="change">concurrencyLevel(</a>1<a id="change">)</a>);
    Segment&lt;Object, Object&gt; segment = map.segments[0];
    // TODO(fry): check recency ordering

    Object key = new Object();
    int hash = map.hash(key);
    Object value = new Object();
    AtomicReferenceArray&lt;ReferenceEntry&lt;Object, Object&gt;&gt; table = segment.table;
    int index = hash & (table.length() - 1);

    ReferenceEntry&lt;Object, Object&gt; <a id="change">entry</a> = map.newEntry(key, hash, null);
    ValueReference&lt;Object, Object&gt; valueRef = map.newValueReference(entry, value);
    entry.setValueReference(valueRef);
</code></pre><h3>After Change</h3><pre><code class='java'>

  public void testSegmentGetAndContains() {
    MapMakerInternalMap&lt;Object, Object, ?, ?&gt; map =
        makeMap(createMapMaker().<a id="change">concurrencyLevel(</a>1<a id="change">)</a>.<a id="change">weakValues()</a>);
    Segment&lt;Object, Object, ?, ?&gt; segment = map.segments[0];
    // TODO(fry): check recency ordering

    Object key = new Object();
    int hash = map.hash(key);
    Object value = new Object();
    AtomicReferenceArray&lt;? extends InternalEntry&lt;Object, Object, ?&gt;&gt; table = segment.table;
    int index = hash & (table.length() - 1);

    InternalEntry&lt;Object, Object, ?&gt; <a id="change">entry</a> = segment.newEntryForTesting(key, hash, null);
    segment.setValueForTesting(entry, value);

    assertNull(segment.get(key, hash));</code></pre>